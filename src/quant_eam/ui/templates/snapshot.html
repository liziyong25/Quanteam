{% extends "base.html" %}
{% block content %}
  <h1>Snapshot {{ snapshot_id }}</h1>

  <div class="card">
    <div><b>snapshot_dir</b>: {{ snapshot_dir }}</div>
  </div>

  <h2>As-Of Preview (ohlcv_1d)</h2>
  <div class="card">
    <form method="get" action="/ui/snapshots/{{ snapshot_id }}">
      <label>symbols <input name="symbols" value="{{ preview_symbols }}" /></label>
      <label>start <input name="start" value="{{ preview_start }}" /></label>
      <label>end <input name="end" value="{{ preview_end }}" /></label>
      <label>as_of <input name="as_of" value="{{ preview_as_of }}" size="28" /></label>
      <label>limit <input name="limit" value="{{ preview_limit }}" size="6" /></label>
      <button type="submit">Preview</button>
    </form>
    <div class="muted">Preview is served via DataCatalog.query_ohlcv (enforces available_at &lt;= as_of). No direct CSV reads.</div>
  </div>

  {% if preview_stats_json %}
  <h3>Preview Stats</h3>
  <pre class="code">{{ preview_stats_json }}</pre>
  {% endif %}

  {% if preview_rows %}
  <h3>Preview Rows</h3>
  <table class="table">
    <thead>
      <tr>
        <th>symbol</th>
        <th>dt</th>
        <th>open</th>
        <th>high</th>
        <th>low</th>
        <th>close</th>
        <th>volume</th>
        <th>available_at</th>
        <th>source</th>
      </tr>
    </thead>
    <tbody>
      {% for r in preview_rows %}
      <tr>
        <td>{{ r.symbol }}</td>
        <td>{{ r.dt }}</td>
        <td>{{ r.open }}</td>
        <td>{{ r.high }}</td>
        <td>{{ r.low }}</td>
        <td>{{ r.close }}</td>
        <td>{{ r.volume }}</td>
        <td>{{ r.available_at }}</td>
        <td>{{ r.source }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}

  {% if quality_key_json %}
  <h2>Quality (key metrics)</h2>
  <pre class="code">{{ quality_key_json }}</pre>
  {% endif %}

  <h2>manifest.json</h2>
  <pre class="code">{{ manifest_json }}</pre>

  {% if ingest_manifest_json %}
  <h2>ingest_manifest.json</h2>
  <pre class="code">{{ ingest_manifest_json }}</pre>
  {% endif %}

  {% if quality_report_json %}
  <h2>quality_report.json</h2>
  <pre class="code">{{ quality_report_json }}</pre>
  {% endif %}
{% endblock %}

